#!/usr/bin/python
import signal
import sys
import os

sys.path.append("/usr/local/IBSng/addons/pexpect")
import pexpect

TIMEOUT = 10


def main():
    doRSH(sys.argv[1], sys.argv[2], TIMEOUT)


def doRSH(host, command, timeout):
    child = pexpect.spawn("/usr/bin/sh", [host, command], timeout)

    log_file = '/var/log/output.log'

    # Wait for the expected output
    child.expect(pexpect.EOF)  # This waits until the child process exits

    # Retrieve the captured output
    output = child.before.decode()  # Convert bytes to string

    # Print or use the captured output as needed
    print(output)
    sys.stdout.write(output)
    with open(log_file, 'w') as f:
        f.write(output)

    if not success:
        sys.stderr.write("Timeout occured\n")


main()
